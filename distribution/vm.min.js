$vm.init=function(n){$vm.user_name="guest",$vm.user_id="-",$vm.user_ip="0",$vm.sys_N=0,$vm.request({cmd:"user_info"},function(t){$vm.user_name=t.records[0].user_name,$vm.user_id=t.records[0].user_id,$vm.user_ip=t.records[0].user_ip,n!==undefined&&n(t)})},$vm._id=-1,$vm.id=function(){return $vm._id++,"_"+$vm._id.toString()},_g_current_path="",$vm.load_module=function(n,t,i){var s,b,r,e,f,u,p,y,o,a;if(n!=undefined){if(_g_vm_chrom_loop=0,i==undefined&&(i={}),s=$vm.root_layout_content_slot,t!=undefined&&t!=""&&(s=t),t=="hidden"&&(s=undefined),t=s,$vm.module_list[n]===undefined){alert("The module '"+n+"' is not in the module list.");return}if(b=$vm.module_list[n].table_id,r=$vm.module_list[n].url,r!==undefined)if(r=$vm.url(r),e=$vm.module_list[n].id,e==undefined&&(e=$vm.id()),$vm.module_list[n].id=e,f=n,u=e,r[0]=="/"&&(r=$vm.hosting_path+r),p=r.split("/").pop(),_g_current_path=r.replace(p,""),$("#D"+u).length===0&&($vm.vm[u]={}),$vm.vm[u].current_path=_g_current_path,$vm.vm[u].input=i,$vm.vm[u].name=n,$("#D"+u).length==0){var h=window.location.href.substring(0,window.location.href.lastIndexOf("/")).split("/?")[0],c=r,v=localStorage.getItem(h+c+"_ver"),w=localStorage.getItem(h+c+"_txt"),l=0;(r.indexOf("http://127.0.0.1")!=-1||r.indexOf("http://localhost")!=-1)&&(l=1),y=0,window.location.toString().indexOf("reload="+f)!=-1&&(y=1),v!=$vm.ver[0]||l==1||w==null||$vm.reload!=""||y==1?(o=r+"?_v="+(new Date).getTime(),r.indexOf("?")!==-1&&(o=r+"&_v="+($vm.ver[0]+$vm.reload).replace(/\./,"")),console.log("loading from url. "+o+" "+v+"/"+$vm.ver[0]+" 127:"+l+" re:"+$vm.reload),window.location.hostname!="127.0.0.1"&&window.location.hostname!="localhost"&&$("#vm_loader").show(),$.get(o,function(n){var e,i;n.indexOf("__CURRENT_NAME__")!=-1&&(e=o.split("/").pop().split("?")[0],n=n.replace(/__CURRENT_NAME__/g,e)),localStorage.setItem(h+c+"_txt",n),localStorage.setItem(h+c+"_ver",$vm.ver[0]),i=n,i.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(i,u,r,t,f),$vm.insert_and_trigger_load(u,t)):$vm.process_first_include(i,u,t,r,f)}).fail(function(){alert("The file '"+r+"' doesn't exist!")})):(console.log("loading from stotage. "+r+" "+v+"/"+$vm.ver[0]+" 127:"+l+" re:"+$vm.reload),a=w,a.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(a,u,r,t,f),$vm.insert_and_trigger_load(u,t)):$vm.process_first_include(a,u,t,r,f))}else $vm.insert_and_trigger_load(u,t)}},$vm.create_module_and_run_code=function(n,t,i,r,u){var f,e,o;if(n=n.replace(/__CURRENT_PATH__/g,$vm.vm[t].current_path),f=n,u!=undefined&&$vm.module_list[u]!=undefined&&$vm.module_list[u].full_content!=="1"&&(e=$(f).filter("#D__ID").html(),e!=undefined&&e!=""&&(f=e)),f=$vm.url(f),u!=undefined&&$vm.module_list[u]!=undefined&&$vm.module_list[u].html_filter!=undefined&&(f=$vm.module_list[u].html_filter(f)),f=f.replace(/__ID/g,t),f=f.replace(/<!--([\s\S]*?)-->/mig,""),r!="body"?(f="<div id=D"+t+" module='"+u+"' class=vm_module style='display:none'><!--"+i+"-->"+f+"<\/div>",$("#D"+t).remove(),(r==""||r==undefined)&&(r=$vm.root_layout_content_slot),$("#"+r).append($(f))):$("body").append($(f)),typeof window["F"+t]=="function")try{eval("F"+t+"()")}catch(s){o=i,o===undefined&&(o=t),alert(s+"\r\nThis error happend in the module\r\n"+o)}$("#D"+t).on("dblclick",function(n){n.stopPropagation(),$vm.source(""+t,n)});$vm.vm_module_border!==undefined&&$("div.vm_module").css("border","1px solid red")},$vm.insert_and_trigger_load=function(n,t){t!="body"&&($vm.insert_module({pid:n,slot:t}),$("#D"+n).triggerHandler("load")),$("#vm_loader").hide()},$vm.insert_module=function(n){var t,r,e,u,o,f,i,s,h;if(($vm.page_stack==undefined&&($vm.page_stack=[],$vm.page_stack_index=0),t=n.pid,r=n.slot,t!==undefined)&&r!==undefined&&r!=""){e=$vm.page_stack.length,e!=0&&(u=$vm.page_stack[e-1],u!=undefined&&u.slot==r&&($("#D"+u.ID).css("display","none"),$("#D"+u.ID).triggerHandler("hide"))),$("#D"+t).css("display","block"),$("#D"+t).triggerHandler("show"),$vm.page_stack_index++,$vm.page_stack.push({ID:t,slot:r,index:$vm.page_stack_index}),o=null,$vm.vm_router!=undefined&&(f="",i=window.location.href.split("?"),i.length==2&&i[1].length>0&&(i[1][0]!="/"?f="&"+i[1]:(s=i[1].split("&")[0],f=i[1].replace(s,""))),h=i[0].split(".").pop(),o=h=="html"?i[0]+"?/"+$vm.vm[t].name.replace(/_/g,"/")+f:$vm.hosting_path+"/?/"+$vm.vm[t].name.replace(/_/g,"/")+f),window.history.pushState({ID:t,slot:r,index:$vm.page_stack_index},null,o),$vm.show!=undefined&&$vm.show(t),console.log($vm.page_stack);return}},$vm.process_first_include=function(n,t,i,r,u){for(var e=n.split("\n"),f=0;f<e.length;f++)if(e[f].length>10&&e[f].indexOf("VmInclude:")!==-1){$vm.load_include(e,f,t,i,r,u);return}},$vm.load_include=function(n,t,i,r,u,f){var y=n[t].replace("VmInclude:","").trim(),o=y.split("|"),e=$vm.url(o[0]),c,l;e[0]=="/"&&(e=$vm.hosting_path+e),e=e.replace("__CURRENT_PATH__",$vm.vm[i].current_path);var h=window.location.href.substring(0,window.location.href.lastIndexOf("/")).split("/?")[0],a=localStorage.getItem(h+e+"_ver"),v=localStorage.getItem(h+e+"_txt"),s=0;e.indexOf("http://127.0.0.1")!=-1||e.indexOf("http://localhost")!=-1?s=1:$vm.localhost==!0&&e.indexOf("http://")==-1&&e.indexOf("https://")==-1&&(s=1,e=e[0]=="/"?$vm.hosting_path+e:$vm.hosting_path+"/"+e),a!=$vm.version||s==1||v==null||$vm.reload!=""?(c=e+"?_v="+(new Date).getTime(),e.indexOf("?")!==-1&&(c=e+"&_v="+($vm.version+$vm.reload).replace(/\./,"")+"&g="+_g_vm_chrom_loop++),console.log("loading from url. "+c+" "+a+"/"+$vm.version+" 127:"+s+" re:"+$vm.reload),$.get(c,function(s){var a=$("<p>"+s+"<\/p>").filter("#D__ID").html(),c,v,y,p,l;if(a!=undefined&&a!=""&&c_n!=null&&(s=a),o.length>1)for(c=0;c<(o.length-1)/2;c++)v=2*c+1,y=2*c+2,v<o.length&&y<o.length&&(p=new RegExp(o[v],"g"),s=s.replace(p,o[y]));localStorage.setItem(h+e+"_txt",s),localStorage.setItem(h+e+"_ver",$vm.version),l=$vm.replace_and_recreate_content(n,t,s),l.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(l,i,u,r,f),$vm.insert_and_trigger_load(i,r)):$vm.process_first_include(l,i,r,u,f)},"text")):(console.log("loading from stotage. "+e+" "+a+"/"+$vm.version+" 127:"+s+" re:"+$vm.reload),l=$vm.replace_and_recreate_content(n,t,v),l.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(l,i,u,r,f),$vm.insert_and_trigger_load(i,r)):$vm.process_first_include(l,i,r,u,f))},$vm.replace_and_recreate_content=function(n,t,i){var u,r;for(n[t]=i,u="",r=0;r<n.length;r++)u+=n[r]+"\n";return u},$vm.request=function(n,t){$vm.sys_N++,$vm.sys_token="guest|where|when|scode",$vm.debug_message===!0&&(console.log(" "),console.log(n.cmd+"("+$vm.sys_N+") TO "),console.dir(n));var i=(new Date).getTime();$vm.ajax_server_error=0,$.ajax({headers:{Authorization:"Bearer "+$vm.sys_token},type:"POST",url:$vm.api_address,contentType:"application/json",charset:"utf-8",dataType:"json",error:function(n){n.status?alert(n.responseText):alert("Something went wrong")},data:JSON.stringify(n),success:function(r){var u=(new Date).getTime();if($vm.debug_message===!0&&(console.log(" "),console.log(n.cmd+"("+$vm.sys_N+") FROM  --- "+(u-i).toString()+"ms"),console.dir(r)),$vm.ajax_server_error!=1)try{t!==undefined&&t(r)}catch(f){alert(f.toString())}},dataFilter:$vm.request_filter})},$vm.request_filter=function(n){var t=$.parseJSON(n);return t.Error!=undefined&&(alert(t.Error),$vm.ajax_server_error=1),n}