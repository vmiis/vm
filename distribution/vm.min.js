window.onpopstate=function(n){var f,i,t;if(n.state!=undefined){var u=n.state.index,r=0,i=$vm.page_stack.length;i>1&&(f=$vm.page_stack[i-2],r=f.index),u==r?(t=$vm.page_stack.pop(),t!=undefined&&($("#D"+t.ID).css("display","none"),$("#D"+t.ID).triggerHandler("hide")),$vm.page_stack.length==0?window.history.back(-1):(i=$vm.page_stack.length,t=$vm.page_stack[i-1],$("#D"+t.ID).css("display","block"),$("#D"+t.ID).triggerHandler("show"),$vm.show!=undefined&&$vm.show(t.m_name))):u>r&&(i=$vm.page_stack.length,t=$vm.page_stack[i-1],$("#D"+t.ID).css("display","none"),$("#D"+t.ID).triggerHandler("hide"),$("#D"+n.state.ID).css("display","block"),$("#D"+n.state.ID).triggerHandler("show"),$vm.page_stack.push(n.state),$vm.show!=undefined&&$vm.show(n.state.m_name)),console.log($vm.page_stack);return}},$vm.push_back_to_park=function(n){var t=n.div,i;$("#D"+t).length>0&&(i=$("#vm_body").scrollTop(),$("#D"+t).data("scroll",i),$("#D"+t).css("display","none"),$("#D"+t).triggerHandler("hide"))},$vm.push_to_slot=function(n){var i=n.div,r=n.slot,t;$("#D"+i).css("display","block"),$("#D"+i).triggerHandler("show"),t=$("#D"+i).data("scroll"),t==undefined&&(t=0),$("#vm_body").scrollTop(t)},$vm.back=function(n){var i=n.div,t=$("#D"+i).data("back_module"),u=$("#D"+i).data("back_slot"),f,r;$vm.push_back_to_park({div:i}),$vm.push_to_slot({div:t,slot:u}),$("#"+u).data("current",t),f=n.form,r=n.refresh_back,f!==undefined?r===undefined?$("#D"+t).triggerHandler("form_back"):r!==undefined&&$("#D"+t).triggerHandler("refresh_back"):$("#D"+t).triggerHandler("back")},$vm.back_and_refresh=function(n){var t=n.div,i=$("#D"+t).data("back_module"),r=$("#D"+t).data("back_slot");$vm.push_back_to_park({div:t}),$vm.push_to_slot({div:i,slot:r}),$("#"+r).data("current",i),$("#D"+i).triggerHandler("refresh_back")},$vm.date_to_string_dmy=function(n){return $vm.pad(n.getDate(),2)+"/"+$vm.pad(n.getMonth()+1,2)+"/"+n.getFullYear()},$vm.pad=function(n,t){var i="000000000"+n;return i.substr(i.length-t)},$vm.date_parse=function(n){try{var t=n.split("/");return new Date(t[2],t[1]-1,t[0])}catch(i){return new Date(1800,0,1)}},$vm.date_weekfirst=function(n){var t=new Date(n),i=t.getDay(),r=t.getDate()-i+(i==0?-6:1);return new Date(t.setDate(r))},$vm.date_day_diff=function(n,t){var i=(t.getTimezoneOffset()-n.getTimezoneOffset())*6e4;return Math.floor((t.getTime()-n.getTime()-i)/864e5)},$vm.first_day_of_current_week=function(){var n=new Date,t=n.getDay(),i=n.getDate()-t+(t==0?-6:1);return new Date(n.setDate(i))},$vm.first_day_of_current_month=function(){var n=new Date,t=n.getFullYear(),i=n.getMonth();return new Date(t,i,1,0,0,0,0)},$vm.first_day_of_current_year=function(){var n=new Date,t=n.getFullYear(),i=new Date(t,0,1);return $vm.date_to_string_dmy(i)},$vm.time12=function(n){var i=n,r=n.split(":"),t=parseInt(r[0])-12;return t>=0?(t==0&&(t=12),i=$vm.pad(t,2)+":"+r[1]+"pm"):(t=t+12,t==0&&(t=12),i=$vm.pad(t,2)+":"+r[1]+"am"),i},$vm.date_today=function(){var n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0)},$vm.date_yyyymmdd_parse=function(n){try{var t=n.split("-");return new Date(t[0],t[1]-1,t[2])}catch(i){return new Date(1800,0,1)}},$vm.au_date_to_string_yyyymmdd=function(n){var t,i;return n==undefined?"":(t=n.split("/"),t.length==3&&t[2].length==4?(i=new Date(t[2],t[1]-1,t[0]),i.getFullYear()+"-"+$vm.pad(i.getMonth()+1,2)+"-"+$vm.pad(i.getDate(),2)):n)},$vm.date_to_string_yyyymmdd=function(n){return n.getFullYear()+"-"+$vm.pad(n.getMonth()+1,2)+"-"+$vm.pad(n.getDate(),2)},$vm.date_to_ddmmyyyy=function(n){if(n==undefined||n==null||n=="")return"";var t=n.toString().split("-"),i=t[0],r=t[1],u=t[2];return u+"/"+r+"/"+i},$vm.yyyymmdd_to_ddmmyyyy=function(n){var t;if(n==undefined||n==null||n=="")return"";t=n.toString().split("-"),t.length!=3&&(t=n.toString().split("/"));var i=t[0],r=t[1],u=t[2];return u+"/"+r+"/"+i},$vm.date_add_days=function(n,t){var i=n.getTime()+864e5*t,r=n.getTime()+(864e5*t+36e5),e=new Date(i),u=new Date(r),f=(u.getTimezoneOffset()-n.getTimezoneOffset())*6e4;return new Date(i+f)},$vm.date_to_yyyymmdd=function(n){return n.getFullYear()+"-"+$vm.pad(n.getMonth()+1,2)+"-"+$vm.pad(n.getDate(),2)},$vm.render_checkbox_field=function(n,t,i,r){var u=i.attr("data-id");i.html(r),(n[u]=="1"||n[u]=="True"||n[u]=="on")&&i.find("input").prop("checked",!0);i.find("input").on("click",function(){var i="0";($(this).prop("checked")==!0&&(i="1"),i!==""||n[u]!==undefined)&&i!==n[u]&&(n.vm_dirty=1,n[u]=i,$("#save"+t).css("background","#E00"))})},$vm.init=function(n){if($vm.user_name="guest",$vm.user_id="-",$vm.user_ip="0",$vm.sys_N=0,n!=undefined){if($vm.api_type=="sqlserver"){$vm.init_s(n);return}$vm.request({cmd:"user-info"},function(t){$vm.user_name=t.records[0].user_name,$vm.displayname=t.records[0].displayname,n!==undefined&&n(t)})}},$vm.init_s=function(n){$vm.vm==undefined&&($vm.vm={}),$vm.edge=0,navigator.appVersion.indexOf("Edge")!=-1&&($vm.edge=1),$vm.user="guest",$VmAPI.request({data:{cmd:"user_name",ip:$vm.ip},callback:function(t){t.user!==undefined&&($vm.user=t.user,$vm.user_name=t.user,$vm.user_id=t.user_id,$vm.user_ip=t.user_ip,$vm.user_puid=t.user_puid),n!==undefined&&n(t)}})},$vm.create_component_and_run=function(n,t,i,r){var f=t.split("/").pop(),e=t.replace(f,""),u;if(n=n.replace(/__CURRENT_PATH__/g,e),u=$vm.id(),n=n.replace(/__ID/g,u),n=n.replace(/__MODULE__/g,r),n=$vm.url(n),$("#"+i).append(n),typeof window["F"+u]=="function")try{eval("F"+u+"()")}catch(o){alert(o+"\r\nThis error happend in the module\r\n"+t)}$("#D"+u).attr("module",r),$("#D"+u).triggerHandler("load")},$vm.load_component_include_and_run=function(n,t,i,r,u){var y=i.split("/").pop(),p=i.replace(y,""),h=n[t].replace("//VmInclude:","").replace("VmInclude:","").trim(),f,s,v;h=h.replace(/\'/g,"").replace(/\"/g,""),f=$vm.url(h),f[0]=="/"&&(f=$vm.hosting_path+f),f=f.replace("__CURRENT_PATH__",p);var l=function(n,t){n.indexOf("VmInclude:")==-1?$vm.create_component_and_run(n,i,t,u):$vm.process_component_include_and_run(n,i,t,u)},e=window.location.href.substring(0,window.location.href.lastIndexOf("/")).split("/?")[0],c=localStorage.getItem(e+f+"ver"),a=localStorage.getItem(e+f+"txt"),o=0;(i.indexOf("http://127.0.0.1")!=-1||i.indexOf("http://localhost")!=-1||i.indexOf("http://vmiis-local.com")!=-1)&&(o=1),c!=$vm.ver[0]||o==1||a==null||$vm.reload!=""?(s=f+"?_v="+(new Date).getTime(),i.indexOf("?")!==-1&&(s=f+"&_v="+($vm.ver[0]+$vm.reload).replace(/\./,"")+"&g="+_g_vm_chrom_loop++),console.log("loading from url. "+s+" "+c+"/"+$vm.ver[0]+" 127:"+o+" re:"+$vm.reload),$.get(s,function(u){var f=$("<p>"+u+"<\/p>").filter("#D__ID").html(),o;f!=undefined&&f!=""&&f!=null&&(u=f),localStorage.setItem(e+i+"_txt",u),localStorage.setItem(e+i+"_ver",$vm.ver[0]),o=$vm.replace_and_recreate_content(n,t,u),l(o,r)},"text")):(console.log("loading from stotage. "+f+" "+c+"/"+$vm.ver[0]+" 127:"+o+" re:"+$vm.reload),v=$vm.replace_and_recreate_content(n,t,a),l(v,r))},$vm.process_component_include_and_run=function(n,t,i,r){for(var f=n.split("\n"),u=0;u<f.length;u++)if(f[u].length>10&&f[u].indexOf("VmInclude:")!==-1){$vm.load_component_include_and_run(f,u,t,i,r);return}},$vm.load_component=function(n,t,i,r){var u,c,s,h;if($vm.module_list[n]==undefined&&r==undefined){alert("The module '"+n+"' is not in the module list.");return}if(u=$vm.module_list[n].url,u==undefined&&r==undefined){alert("The module '"+n+"' does not have url.");return}if($vm.module_list[n]!=undefined&&(u=$vm.module_list[n].url,u!=undefined)){c=$vm.module_list[n],c.input=i;var f=window.location.href.substring(0,window.location.href.lastIndexOf("/")).split("/?")[0],o=localStorage.getItem(f+u+"ver"),l=localStorage.getItem(f+u+"txt"),e=0;(u.indexOf("http://127.0.0.1")!=-1||u.indexOf("http://localhost")!=-1||u.indexOf("http://vmiis-local.com")!=-1)&&(e=1),s=function(t,i){t.indexOf("VmInclude:")==-1?$vm.create_component_and_run(t,u,i,n):$vm.process_component_include_and_run(t,u,i,n)},h=0,window.location.toString().indexOf("reload="+n)!=-1&&(h=1),o!=$vm.ver[0]||e==1||l==null||$vm.reload!=""||h==1?$.get(u+"?_="+(new Date).getTime(),function(n){localStorage.setItem(f+u+"txt",n),localStorage.setItem(f+u+"ver",$vm.ver[0]),console.log("loading from url. "+u+" "+o+"/"+$vm.ver[0]+" 127:"+e),s(n,t)},"text"):(console.log("loading from storage. "+u+" "+o+"/"+$vm.ver[0]+" 127:"+e),s(l,t))}},$vm.id=function(){return $vm._id==undefined&&($vm._id=0),$vm._id++,"_"+$vm._id.toString()},$vm.load_content=function(n,t,i,r){var f=$vm.module_list[n].url,s=window.location.href.substring(0,window.location.href.lastIndexOf("/")).split("/?")[0],u,e,o;localStorage.setItem(s+f+"_txt",r),t==""&&(t=$vm.root_layout_content_slot),u=$vm.module_list[n].id,u==undefined&&(u=$vm.id()),$vm.module_list[n].id=u,$vm.vm[u]={},f[0]=="/"&&(f=$vm.hosting_path+f),e=f.split("/").pop(),o=f.replace(e,""),$vm.vm[u].current_path=o,r.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(r,u,f,t,n),$vm.insert_and_trigger_load(u,t,n)):$vm.process_first_include(r,u,t,f,n)},_g_current_path="",$vm.load_module=function(n,t,i){var s,r,e,y,f,u,p,v,o,l;if(n!=undefined){if($vm.vm==undefined&&($vm.vm={}),_g_vm_chrom_loop=0,i==undefined&&(i={}),s=$vm.root_layout_content_slot,t!=undefined&&t!=""&&(s=t),t=="hidden"&&(s=undefined),t=s,$vm.module_list[n]===undefined){alert("The module '"+n+"' is not in the module list.");return}if(r=$vm.module_list[n].url,r!==undefined)if(r=$vm.url(r),e=$vm.module_list[n].id,e==undefined&&(e=$vm.id()),$vm.module_list[n].id=e,y=$vm.module_list[n],y.input=i,f=n,u=e,r[0]=="/"&&(r=$vm.hosting_path+r),p=r.split("/").pop(),_g_current_path=r.replace(p,""),$("#D"+u).length===0&&($vm.vm[u]={}),$vm.vm[u]==undefined&&($vm.vm[u]={}),$vm.vm[u].current_path=_g_current_path,$vm.vm[u].input=i,$vm.vm[u].name=n,$vm.vm[u].url=r,$("#D"+u).length==0){var b=window.location.href.substring(0,window.location.href.lastIndexOf("/")).split("/?")[0],h=r,a=localStorage.getItem(h+"_ver"),w=localStorage.getItem(h+"_txt"),c=0;(r.indexOf("http://127.0.0.1")!=-1||r.indexOf("http://localhost")!=-1||r.indexOf("http://vmiis-local.com")!=-1)&&(c=1),v=0,window.location.toString().indexOf("reload="+f)!=-1&&(v=1),a!=$vm.ver[0]||c==1||w==null||$vm.reload!=""||v==1?(o=r+"?_v="+(new Date).getTime(),r.indexOf("?")!==-1&&(o=r+"&_v="+($vm.ver[0]+$vm.reload).replace(/\./,"")),console.log("loading from url. "+o+" "+a+"/"+$vm.ver[0]+" 127:"+c+" re:"+$vm.reload),window.location.hostname!="127.0.0.1"&&window.location.hostname!="localhost"&&$("#vm_loader").show(),$.get(o,function(n){var e,i;n.indexOf("__CURRENT_NAME__")!=-1&&(e=o.split("/").pop().split("?")[0],n=n.replace(/__CURRENT_NAME__/g,e)),localStorage.setItem(h+"_txt",n),localStorage.setItem(h+"_ver",$vm.ver[0]),i=n,i.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(i,u,r,t,f),$vm.insert_and_trigger_load(u,t,f)):$vm.process_first_include(i,u,t,r,f)}).fail(function(){alert("The module '"+r+"' doesn't exist or you have AdBlock that blocks this remote module to be loaded.")})):(console.log("loading from stotage. "+r+" "+a+"/"+$vm.ver[0]+" 127:"+c+" re:"+$vm.reload),l=w,l.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(l,u,r,t,f),$vm.insert_and_trigger_load(u,t,f)):$vm.process_first_include(l,u,t,r,f))}else $vm.insert_and_trigger_load(u,t,f)}},$vm.load_module_v2=$vm.load_module,$vm.create_module_and_run_code=function(n,t,i,r,u){var f,e,o;if(n=n.replace(/__CURRENT_PATH__/g,$vm.vm[t].current_path),f=n,u!=undefined&&$vm.module_list[u]!=undefined&&$vm.module_list[u].full_content!=="1"&&(e=$(f).filter("#D__ID").html(),e!=undefined&&e!=""&&(f=e)),f=$vm.url(f),u!=undefined&&$vm.module_list[u]!=undefined&&$vm.module_list[u].html_filter!=undefined&&(f=$vm.module_list[u].html_filter(f)),f=f.replace(/__ID/g,t),f=f.replace(/__MODULE__/g,u),f=f.replace(/<!--([\s\S]*?)-->/mig,""),r!="body"?(f="<div id=D"+t+" module='"+u+"' style='display:none'><!--"+i+"-->"+f+"<\/div>",$("#D"+t).remove(),(r==""||r==undefined)&&(r=$vm.root_layout_content_slot),$("#"+r).append($(f))):$("body").append($(f)),typeof window["F"+t]=="function")try{eval("F"+t+"()")}catch(s){o=i,o===undefined&&(o=t),alert(s+"\r\nThis error happend in the module\r\n"+o)}$("#D"+t).on("dblclick",function(n){n.stopPropagation(),$vm.source(""+t,n)})},$vm.insert_and_trigger_load=function(n,t,i){t!="body"&&($vm.insert_module({module_id:n,slot:t,m_name:i}),$("#D"+n).triggerHandler("load"),window.scrollTo(0,0)),$("#vm_loader").hide()},$vm.insert_module=function(n){var i,r,e,u,o,f,t,s,h;if(($vm.page_stack==undefined&&($vm.page_stack=[],$vm.page_stack_index=0),i=n.module_id,r=n.slot,i!==undefined)&&r!==undefined&&r!=""&&(e=$vm.page_stack.length,e!=0&&(u=$vm.page_stack[e-1],u!=undefined&&u.slot==r&&($("#D"+u.ID).css("display","none"),$("#D"+u.ID).triggerHandler("hide"))),$("#D"+i).css("display","block"),$("#D"+i).triggerHandler("show"),r==$vm.root_layout_content_slot)){$vm.page_stack_index++,$vm.page_stack.push({m_name:n.m_name,ID:i,slot:r,index:$vm.page_stack_index}),o=null,$vm.module_list[n.m_name].router!=undefined&&(f="",t=window.location.href.split("?"),t.length==2&&t[1].length>0&&(t[1][0]!="/"?f="&"+t[1]:(s=t[1].split("&")[0],f=t[1].replace(s,""))),h=t[0].split(".").pop(),o=h=="html"?t[0]+"?/"+$vm.vm[i].name.replace(/_/g,"/")+f:$vm.hosting_path+"/?/"+$vm.vm[i].name.replace(/_/g,"/")+f),window.history.pushState({m_name:n.m_name,ID:i,slot:r,index:$vm.page_stack_index},null,o),$vm.show!=undefined?$vm.show(n.m_name):$vm.first_module==undefined&&($vm.first_module=n.m_name);return}},$vm.process_first_include=function(n,t,i,r,u){for(var e=n.split("\n"),f=0;f<e.length;f++)if(e[f].length>10&&e[f].indexOf("VmInclude:")!==-1){$vm.load_include(e,f,t,i,r,u);return}},$vm.load_include=function(n,t,i,r,u,f){var s=n[t].replace("//VmInclude:","").replace("VmInclude:","").trim(),o,e,l,a;s=s.replace(/\'/g,""),s=s.replace(/\"/g,""),o=s.split("|"),e=$vm.url(o[0]),e[0]=="/"&&(e=$vm.hosting_path+e),e=e.replace("__CURRENT_PATH__",$vm.vm[i].current_path);var c=window.location.href.substring(0,window.location.href.lastIndexOf("/")).split("/?")[0],v=localStorage.getItem(c+e+"_ver"),y=localStorage.getItem(c+e+"_txt"),h=0;e.indexOf("http://127.0.0.1")!=-1||e.indexOf("http://localhost")!=-1||e.indexOf("http://vmiis-local.com")!=-1?h=1:$vm.localhost==!0&&e.indexOf("http://")==-1&&e.indexOf("https://")==-1&&(h=1,e=e[0]=="/"?$vm.hosting_path+e:$vm.hosting_path+"/"+e),v!=$vm.ver[0]||h==1||y==null||$vm.reload!=""?(l=e+"?_v="+(new Date).getTime(),e.indexOf("?")!==-1&&(l=e+"&_v="+($vm.ver[0]+$vm.reload).replace(/\./,"")+"&g="+_g_vm_chrom_loop++),console.log("loading from url. "+l+" "+v+"/"+$vm.ver[0]+" 127:"+h+" re:"+$vm.reload),$.get(l,function(s){var l=$("<p>"+s+"<\/p>").filter("#D__ID").html(),h,v,y,p,a;if(l!=undefined&&l!=""&&l!=null&&(s=l),o.length>1)for(h=0;h<(o.length-1)/2;h++)v=2*h+1,y=2*h+2,v<o.length&&y<o.length&&(p=new RegExp(o[v],"g"),s=s.replace(p,o[y]));localStorage.setItem(c+e+"_txt",s),localStorage.setItem(c+e+"_ver",$vm.ver[0]),a=$vm.replace_and_recreate_content(n,t,s),a.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(a,i,u,r,f),$vm.insert_and_trigger_load(i,r,f)):$vm.process_first_include(a,i,r,u,f)},"text")):(console.log("loading from stotage. "+e+" "+v+"/"+$vm.ver[0]+" 127:"+h+" re:"+$vm.reload),a=$vm.replace_and_recreate_content(n,t,y),a.indexOf("VmInclude:")==-1?($vm.create_module_and_run_code(a,i,u,r,f),$vm.insert_and_trigger_load(i,r,f)):$vm.process_first_include(a,i,r,u,f))},$vm.replace_and_recreate_content=function(n,t,i){var u,r;for(n[t]=i,u="",r=0;r<n.length;r++)u+=n[r]+"\n";return u},$vm.request=function(n,t){var r,i,u;$vm.sys_N++,$vm.sys_token="guest|where|when|scode",$vm.debug_message===!0&&console.log("%c"+n.cmd+"("+$vm.sys_N+") TO ","color:orange",n),r=(new Date).getTime(),$vm.ajax_server_error=0,i=sessionStorage.getItem("vm_token"),i==undefined&&(i=""),u={headers:{Authorization:"Bearer "+i},type:"POST",url:$vm.api_address,contentType:"application/json",charset:"utf-8",dataType:"json",error:function(n){n.status},data:JSON.stringify(n),success:function(i){var u=(new Date).getTime();if($vm.debug_message===!0&&(i.status=="ok"?console.log("%c"+n.cmd+"("+$vm.sys_N+") FROM --- "+(u-r).toString()+"ms","color:lightgreen",i):console.log("%c"+n.cmd+"("+$vm.sys_N+") FROM --- "+(u-r).toString()+"ms","color:red",i)),$vm.ajax_server_error!=1)try{t!==undefined&&t(i)}catch(f){alert(f.toString())}},dataFilter:$vm.request_filter},n.cmd=="export"&&(u.xhr=function(){var i=1,n=new window.XMLHttpRequest;return n.addEventListener("progress",function(){var u=-1,f="",r=n.responseText.length;r>=5&&u==-1&&(u=parseInt(n.responseText.substring(0,5))),r>=14&&(f=n.responseText.substring(r-9,r)),f=="__E_N_D__"&&(i=-1),t(u,i,n.responseText),i++},!1),n}),$.ajax(u)},$vm.request_filter=function(n){try{var t=$.parseJSON(n);t.Error!=undefined&&(alert(t.Error),$vm.ajax_server_error=1)}catch(i){}return n},$vm.set_token=function(n){sessionStorage.setItem("vm_token",n)},$vm.clear_token=function(){sessionStorage.setItem("vm_token","")},function(){var n="notoken",t;$VmAPI.set_token=function(t,i,r,u,f){sessionStorage.setItem("ahsj634cupsd6349wquyewij4swq7202",t),sessionStorage.setItem("x7645hscvf650hd64083hgf69087201a",i),sessionStorage.setItem("h3879j478450wjh830ks9937300kj3kj",r),sessionStorage.setItem("gu8309ihd407js6h59eje8jhl630543h",u),sessionStorage.setItem("v84yw673jhekerhgs4fld54hdfzshjrt",f),n=t,t==""&&(n="notoken")},$VmAPI.clear_token=function(){sessionStorage.setItem("ahsj634cupsd6349wquyewij4swq7202","notoken"),sessionStorage.setItem("x7645hscvf650hd64083hgf69087201a",""),sessionStorage.setItem("h3879j478450wjh830ks9937300kj3kj",""),sessionStorage.setItem("gu8309ihd407js6h59eje8jhl630543h",""),sessionStorage.setItem("v84yw673jhekerhgs4fld54hdfzshjrt","")},$VmAPI.get_username=function(){return sessionStorage.getItem("h3879j478450wjh830ks9937300kj3kj")},t=0,$VmAPI.request=function(i){var u,r,f,e,o,s;t++,u=t,n=sessionStorage.getItem("ahsj634cupsd6349wquyewij4swq7202"),typeof n==undefined&&(console.log("safari bug"),n="notoken"),r=i.data,f=i.callback,$VmAPI.ajax_server_error=0,e=$VmAPI.api_base+"api.aspx?api=1",$vm.debug_message===!0&&(console.log(" "),console.log(r.cmd+"("+u+") TO "),console.dir(r)),o=(new Date).getTime(),s={Authorization:"Bearer "+n},$.ajax({headers:s,type:"POST",url:e,contentType:"application/json",charset:"utf-8",dataType:"json",error:function(n){n.status?alert(n.responseText):alert("Something went wrong")},data:JSON.stringify(r),success:function(n){var t=(new Date).getTime();if($vm.debug_message===!0&&(console.log(" "),console.log(r.cmd+"("+u+") FROM  --- "+(t-o).toString()+"ms"),console.dir(n)),$VmAPI.ajax_server_error!=1)try{f!==undefined&&f(n)}catch(i){alert(i.toString())}},dataFilter:$VmAPI.request_filter})},$VmAPI.connect=function(t,i,r,u){var e=$VmAPI.api_base.replace("https://","wss://")+"api.ashx",f=new WebSocket(e);f.onmessage=r,f.onopen=function(){f.send("VM_CONNECT:"+n+"|"+t+"|"+i),u(f)}}}(),$VmAPI.request_filter=function(n){var t=$.parseJSON(n);return t.Error!=undefined&&(console.log(t.Error),$VmAPI.ajax_server_error=1,typeof $VmAPI.submit_div!="undefined"&&$VmAPI.submit_div!=""&&$("#D"+$VmAPI.submit_div).triggerHandler("submit_failed")),n},$vm.upload_form_files=function(n,t,i,r){var u=0;t.find("input[type=file]").each(function(){this.files.length===1&&u++}),u!=0?t.find("input[type=file]").each(function(){if(this.files.length===1){var t=this.name,f=n.aws[t];$vm.uploading_file(f,this.files[0],i,function(){u--,u==0&&r()})}}):r()},$vm.upload_form_files_s=function(n,t,i,r){var u=0;t.find("input[type=file]").each(function(){this.files.length===1&&u++}),u!=0?t.find("input[type=file]").each(function(){if(this.files.length===1){var t=this.name,f=n["file__"+t];$vm.uploading_file(f,this.files[0],i,function(){u--,u==0&&r()})}}):r()},$vm.uploading_file=function(n,t,i,r){t&&$.ajax({xhr:function(){var n=new window.XMLHttpRequest;return n.upload.addEventListener("progress",function(n){$("#"+i).text(n.loaded)},!1),n},url:n,type:"PUT",data:t,headers:{"Content-Type":t.type},cache:!1,processData:!1}).done(function(){r()}).fail(function(){alert("Upload error")})},$vm.open_s3_url=function(n,t,i,r,u){$vm.request({cmd:"s3_download_url",id:n,table:t,filename:i,url:r,expires:u},function(n){if(n.sys.permission==!1){alert("No permission.");return}var t=document.createElement("a");t.href=n.result,t.style="visibility:hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)})},$vm.open_s3_url_s=function(n,t,i){var r={cmd:"get_s3_download_url",qid:$vm.qid,rid:n,filename:t,minutes:i};$VmAPI.request({data:r,callback:function(n){var i=document.createElement("a"),r;i.href=n.s3_download_url,i.style="visibility:hidden",r=t.split("-"),i.download=t.replace(r[0]+"-","").replace(/ /g,"_"),document.body.appendChild(i),i.click(),document.body.removeChild(i)}})},$vm.get_image_url=function(n,t,i,r){var e=t.Update_date,f,u,h;if(e==undefined&&(e=t.Submit_date),f=t.Data[n],f==undefined||f==""){r("");return}if(u="img_"+n+"_"+t._id,$vm[u]!=undefined)r($vm[u]);else{var s=localStorage.getItem(u+"_url"),c=localStorage.getItem(u+"_last_load_date"),l=localStorage.getItem(u+"_modified"),a=new Date,v=new Date(c),o=a.getTime()-v.getTime();o=o/864e5,s!==null&&o<6&&l==e?($vm[u]=s,r($vm[u])):(h=t.Table+"/"+t.UID+"-"+n+"-"+f,$vm.request({cmd:"s3_download_url",id:t._id,table:t.Table,filename:f,url:h,expires:i},function(n){if(n.status=="np"){r("");return}localStorage.setItem(u+"_url",n.result),localStorage.setItem(u+"_last_load_date",(new Date).toString()),localStorage.setItem(u+"_modified",e),$vm[u]=n.result,r($vm[u])}))}},$vm.deserialize=function(n,t){n!=undefined&&n.Data!=undefined&&$.each(n.Data,function(n,i){if(n!=""){var r=$(t+" *[name="+n+"]");r.each(function(){var n=$(this),t=n.attr("type");switch(t){case"checkbox":i=="off"||i=="0"||i==""||i==undefined?n.prop("checked",!1):n.prop("checked",!0);break;case"radio":n.attr("value")==i&&n.prop("checked",!0);break;case"file":break;case"text":case"email":case"textarea":case"select":n.val(i);break;case"undefined":break;default:n.val(i)}})}})},$vm.deserialize_s=function(n,t){n!=undefined&&$.each(n,function(n,i){if(n!=""){var r=$(t+" *[name="+n+"]");r.each(function(){var n=$(this),t=n.attr("type");switch(t){case"checkbox":i=="off"||i=="0"||i==""?n.prop("checked",!1):n.prop("checked",!0);break;case"radio":n.attr("value")==i&&n.prop("checked",!0);break;case"file":break;case"text":case"email":case"textarea":case"select":n.val(i);break;case"undefined":break;default:n.val(i)}})}})},$vm.serialize=function(n){var t={},i=$(n).serializeArray();return $.each(i,function(){t[this.name]=this.value||""}),$(n+" input:checkbox:not(:checked)").each(function(){t[this.name]="off"}),$(n+" input:file").each(function(){this.files.length==1&&(t[this.name]=this.files[0].name)}),t},$vm.serialize_file=function(n){var t={};return $(n+" input:file").each(function(){this.files.length==1&&(t[this.name]=this.files[0].name+"|"+this.files[0].type)}),t},$vm.signin=function(){if($vm.api_type=="sqlserver"){$vm.signin_s();return}$vm.user_name=="guest"&&window.open($vm.api_address+"/signin.html","Sign In","width=600, height=700")},$vm.signin_s=function(){$vm.user=="guest"&&window.open($VmAPI.api_base+"signin.html?url="+window.location.href,"Sign In","width=600, height=700")},$vm.signout=function(){if($vm.api_type=="sqlserver"){$vm.signout_s();return}$vm.clear_token(),sessionStorage.signinout=1,location.reload(!0)},$vm.signout_s=function(){$VmAPI.clear_token(),sessionStorage.signinout=1,location.reload(!0)},$vm.show_json_data=function(n){var t=JSON.stringify(n,null,"\t"),i;t=t.replace(/\n/g,"<br>"),t=t.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),i=window.open("","JSON data"),i.document.body.innerHTML=t+"<title>JSON data<\/title><style> body{ font-family:Courier New;font-size:12px; white-space: nowrap; } <\/style>"},$vm.source=function(n,t){if(t.altKey){if($vm.vm[n].url!==undefined){var r="__COMPONENT__/c/code-viewer.01.html",i=$vm.vm[n].url;i[0]=="/"?i=$vm.hosting_path+i:i.substring(0,7)!="http://"&&i.substring(0,8)!="https://"&&(i=$vm.hosting_path+"/"+i),$.get(i+"?"+(new Date).getTime(),function(t){var u=$vm.vm[n].name,f;$vm.module_list[u]!==undefined&&($vm.module_list[u].html_filter!=undefined&&(t=$vm.module_list[u].html_filter(t)),$vm.module_list.sys_code_viewer==undefined&&($vm.module_list.sys_code_viewer={url:r}),f="No."+n.replace("_","")+",  Name:"+u,$vm.module_list[u].Table!=undefined&&(f+=",  Table:"+$vm.module_list[u].Table),f+=",  Url:"+i,$vm.load_module("sys_code_viewer","",{code:t,msg:f}))})}}else t.ctrlKey||t.shiftKey},$vm.set_dropdown_list_from_text=function(n,t){var i=$("<div><\/div>").html(t).text(),f,u;for(i=i.replace(/\r/g,"\n"),i=i.replace(/\n\n/g,"\n"),i=i.replace(/\n/g,","),i=i.replace(/,,/g,","),f=i.split(","),n.html(""),u=0;u<f.length;u++){var o=f[u],r=o.split(";"),e="";r[0].length>0&&r[0]=="*"&&(r[0]=r[0].replace("*",""),e="selected"),r.length==2?n.append($("<option "+e+"><\/option>").val(r[1]).html(r[0])):n.append($("<option "+e+"><\/option>").val(r[0]).html(r[0]))}},$vm.vm_password=function(n,t){var r=0,u="",i,t;for(t==undefined&&(t=!1);r<n;){if(i=Math.floor(Math.random()*100)%94+33,!t){if(i>=33&&i<=47)continue;if(i>=58&&i<=64)continue;if(i>=91&&i<=96)continue;if(i>=123&&i<=126)continue}r++,u+=String.fromCharCode(i)}return u},$vm.autocomplete=function(n,t,i,r){var u=n.attr("data-id");return n.focus(function(){n.autocomplete("search","")}),n.autocomplete({minLength:0,source:function(n,r){t.search=n.term,$vm.request(t,function(n){if(n.sys.permission==!1){console.log("No permission");return}r(i(n.result))})},select:function(n,t){r!=undefined&&r(t.item)}})},$vm.autocomplete_s=function(n,t,i,r){var u=n.attr("data-id");return n.focus(function(){n.autocomplete("search","")}),n.autocomplete({minLength:0,source:function(n,r){$VmAPI.request({data:{cmd:"read",qid:$vm.qid,s1:n.term,sql:t,minLength:0},callback:function(n){r(i(n.records))}})},select:function(n,t){r!=undefined&&r(t.item)}})},$vm.status_of_data=function(n){var i=0,r=0,t;for(key in n)key!=""&&(r++,n[key]==""&&i++);return t="#FFCC00",i==r?t="#FF0000":i==0&&(t="#00FF00"),t},$vm.text=function(n){return $("<div><\/div>").html(n).text()},$vm.invert_color=function(n){var t=function(n,t){t=t||2;var i=new Array(t).join("0");return(i+n).slice(-t)},f=function(){var n=Math.round(Math.random()*16777216).toString(16);return"#"+t(n,6)};if(n.indexOf("#")===0&&(n=n.slice(1)),n.length===3&&(n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]),n.length!==6)throw new Error("Invalid HEX color.");var i=(255-parseInt(n.slice(0,2),16)).toString(16),r=(255-parseInt(n.slice(2,4),16)).toString(16),u=(255-parseInt(n.slice(4,6),16)).toString(16);return"#"+t(i)+t(r)+t(u)},$vm.whire_or_black_color=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n),r=parseInt(t[1],16),u=parseInt(t[2],16),f=parseInt(t[3],16),i="#ffffff";return r*.299+u*.587+f*.114>186&&(i="#000000"),i},$vm.white_or_black_color=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n),r=parseInt(t[1],16),u=parseInt(t[2],16),f=parseInt(t[3],16),i="#ffffff";return r*.299+u*.587+f*.114>186&&(i="#000000"),i},$vm.download_csv=function(n,t){for(var r="",f="",s=[],o,h,u,l,c,e,i=0;i<t.length;i++){if(i==0){for(k in t[i])s.push(k),f!=""&&(f+=","),f+='"'+k+'"';f+="\r\n",r+=f}for(f="",j=0;j<s.length;j++)j!==0&&(f+=","),o="",h=s[j],t[i][h]!==undefined&&(o=t[i][h]),o!=null&&(o=o.toString().replace(/"/g,"")),f+='"'+o+'"';f+="\r\n",r+=f}for(u=[],u.push(239),u.push(187),u.push(191),i=0;i<r.length;i++)r.charCodeAt(i)<128?u.push(r.charCodeAt(i)):r.charCodeAt(i)<2048?(u.push(((r.charCodeAt(i)&192)>>6)+((r.charCodeAt(i)&1792)>>6)+192),u.push(r.charCodeAt(i)&191)):r.charCodeAt(i)<65536&&(u.push(((r.charCodeAt(i)&61440)>>12)+224),u.push(((r.charCodeAt(i)&192)>>6)+((r.charCodeAt(i)&3840)>>6)+128),u.push(r.charCodeAt(i)&191));l=new Uint8Array(u),c=new Blob([l]),navigator.appVersion.toString().indexOf(".NET")>0?window.navigator.msSaveBlob(c,name):(e=document.createElement("a"),e.setAttribute("href",window.URL.createObjectURL(c)),e.setAttribute("download",name),e.style="visibility:hidden",e.download=n,document.body.appendChild(e),e.click(),document.body.removeChild(e))},String.prototype.splitCSV=function(n){for(var t=this.split(n=n||","),i=t.length-1,r;i>=0;i--)t[i].replace(/"\s+$/,'"').charAt(t[i].length-1)=='"'?(r=t[i].replace(/^\s+"/,'"')).length>1&&r.charAt(0)=='"'?t[i]=t[i].replace(/^\s*"|"\s*$/g,"").replace(/""/g,'"'):i?t.splice(i-1,2,[t[i-1],t[i]].join(n)):t=t.shift().split(n).concat(t):t[i].replace(/""/g,'"');return t},$vm.xmlToJson=function(n){var t={},r,e,u,f,i,o;if(n.nodeType==1){if(n.attributes.length>0)for(t["@attributes"]={},r=0;r<n.attributes.length;r++)e=n.attributes.item(r),t["@attributes"][e.nodeName]=e.nodeValue}else n.nodeType==3&&(t=n.nodeValue);if(n.hasChildNodes()&&n.childNodes.length===1&&n.childNodes[0].nodeType===3)t=n.childNodes[0].nodeValue;else if(n.hasChildNodes())for(u=0;u<n.childNodes.length;u++)f=n.childNodes.item(u),i=f.nodeName,typeof t[i]=="undefined"?t[i]=$vm.xmlToJson(f):(typeof t[i].push=="undefined"&&(o=t[i],t[i]=[],t[i].push(o)),t[i].push($vm.xmlToJson(f)));return t},$vm.tool_table_info=function(n,t){var u,i,r;n==undefined&&(n=$vm.user_name),t==undefined&&(t="Find"),u=[],i=[];for(a in $vm.module_list)$vm.module_list[a].Table!=undefined&&i.indexOf($vm.module_list[a].Table)==-1&&i.push($vm.module_list[a].Table);var f=0,e=function(){f++,f==i.length&&console.log(u)},o=function(i){$vm.request({cmd:"permission-check",data:{Table:i,Operation:t,Login:n}},function(n){var o="Yes",r,f;n.sys.tb=="off"&&(o="No "),r="Yes",n.sys.db=="0"&&(r="No "),f="Yes",n.status=="np"&&(f="No "),u.push("private-table: "+o+", \t\tremote-db: "+r+"\t\t"+t+": "+f+"\t\t"+i),e()})},s=function(n){setTimeout(function(){o(i[n])},100*n)};for(r=0;r<i.length;r++)s(r)},$vm.sys_structure=function(){var n="<html>\r\n\t<body>\r\n",t;n+="\t\t<header>\r\n",$("#header >div").each(function(){var u=$(this).attr("id"),t=$(this).attr("module"),i="url:@1span class=c1@2"+$vm.module_list[t].url+"@1/span@2",r=$vm.module_list[t].Table;r!=undefined&&(i=i+", table:@1span class=c2@2"+r+"@1/span@2"),n+="\t\t\t<div id="+u+" module=@1span class=c@2"+t+"@1/span@2>"+i+"<\/div>\r\n"}),n+="\t\t<\/header>\r\n",n+="\t\t<content>\r\n",$("#content >div").each(function(){var u=$(this).attr("id"),t=$(this).attr("module"),i="url:@1span class=c1@2"+$vm.module_list[t].url+"@1/span@2",r=$vm.module_list[t].Table;r!=undefined&&(i=i+", table:@1span class=c2@2"+r+"@1/span@2"),n+="\t\t\t<div id="+u+" module=@1span class=c@2"+t+"@1/span@2>"+i+"<\/div>\r\n"}),n+="\t\t<\/content>\r\n",n+="\t\t<footer>\r\n",$("#footer >div").each(function(){var u=$(this).attr("id"),t=$(this).attr("module"),i="url:@1span class=c1@2"+$vm.module_list[t].url+"@1/span@2",r=$vm.module_list[t].Table;r!=undefined&&(i=i+", table:@1span class=c2@2"+r+"@1/span@2"),n+="\t\t\t<div id="+u+" module=@1span class=c@2"+t+"@1/span@2>"+i+"<\/div>\r\n"}),n+="\t\t<\/footer>\r\n",n+="\t\t<system>\r\n",$("#system >div").each(function(){var u=$(this).attr("id"),t=$(this).attr("module"),i="url:@1span class=c1@2"+$vm.module_list[t].url+"@1/span@2",r=$vm.module_list[t].Table;r!=undefined&&(i=i+", table:@1span class=c2@2"+r+"@1/span@2"),n+="\t\t\t<div id="+u+" module=@1span class=c@2"+t+"@1/span@2>"+i+"<\/div>\r\n"}),n+="\t\t<\/system>\r\n",n+="\t<\/body>\r\n<\/html>",n=n.replace(/</g,"&lt;"),n=n.replace(/>/g,"&gt;"),n=n.replace(/@1/g,"<"),n=n.replace(/@2/g,">"),t=window.open("","Systsm Infomation"),t.document.body.innerHTML="<pre>"+n+"<\/pre><title>System Infomation<\/title><style> .c{color:red;} .c1{color:blue;} .c2{color:green;} body{ font-family:Courier New;font-size:12px; white-space: nowrap; } <\/style>"},$vm.sys_settings=function(){var n=window.location.href.split("?")[0].replace("/index.html","");localStorage.setItem("__temp1001_"+n,JSON.stringify($vm.module_list)),window.open("/sitedev/index.html?path="+n)}